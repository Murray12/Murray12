<!DOCTYPE html>
<html>
<head>
	
		<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.string/2.3.3/underscore.string.min.js"></script>
		<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/path.js/0.8.4/path.min.js"></script>		
		<script src="//www.parsecdn.com/js/parse-1.2.19.min.js"></script>		
		<script src="//cdn.rawgit.com/Artod/baascms/master/dist/baascms-1.0.0.min.js"></script>
		<script src="//cdn.rawgit.com/Artod/baascms/master/dist/baascms-adapter-parse-1.0.0.min.js"></script>
    		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.5/angular.min.js"></script>
    		<script>
			Parse.initialize('lbPrJLH38jokUIjcHFfs2oSU6iEYzPLGrxSpC5YO', 'ThPVIHKZICbSayMVEneWW0FJXs2fbDBFscHJrwQv');
			
			BaasCMS.init({
				baas: 'Parse'
			});
			
			
		</script>
</head>



<body ng-app="submitExample">
	
<script>
  angular.module('submitExample', [])
    .controller('ExampleController', ['$scope', function($scope) {
      $scope.list = [];
      $scope.hashTable;
      $scope.showLeaderBoard = true;
      $scope.name;
      $scope.show = function(){
      	$scope.showLeaderBoard = true;
	var HashTable = Parse.Object.extend("HashTable");
	var query = new Parse.Query(HashTable);
	query.find({
  	success: function(results) {
  		alert("hello");
		$scope.hashTable = results[0];
		alert(hashTable);
  	},
  	error: function(error) {
		alert("Error: " + error.code + " " + error.message);
	}
	});
      }
      $scope.submit = function() {
      	
      	var Visitor= Parse.Object.extend("Visitor");
	var query = new Parse.Query(Visitor);
	query.equalTo("name", $scope.name);
	query.find({
  		success: function(results) {
  			if (results.length == 0){
  				alert("creating new visitor: " + $scope.name);
  				var visitor = new Visitor();
  				visitor.set("name",$scope.name);
  				
  				var currentDate = new Date()
				var day = currentDate.getDate()
				var month = currentDate.getMonth() + 1
				var year = currentDate.getFullYear()

				var today = month+'/'+day+'/'+year;
  				visitor.set("date",today));
  				visitor.set("visits",1);
  				visitor.save(null, {
  success: function(visitor) {
    // Execute any logic that should take place after the object is saved.
    alert('New object created with objectId: ' + visitor.id);
  },
  error: function(visitor, error) {
    // Execute any logic that should take place if the save fails.
    // error is a Parse.Error with an error code and message.
    alert('Failed to create new object, with error code: ' + error.message);
  }
});
  			}
  			else {
  				alert("name: " + results[0].get("name") + " visits: " + results[0].get("visits"));
  			}
  			
    			results[0].increment($scope.text);
    			results[0].save();
  		},
  		error: function(error) {
			alert("Error: " + error.code + " " + error.message);
  		}
	});
	

	};
    }]);
</script>






<form ng-submit="submit()" ng-controller="ExampleController">
  Enter text and hit enter:
  <input type="text" ng-model="name" name="name" />
  <input type="submit" id="submit" value="Submit" />
</form>



<form ng-submit="show()" ng-controller="ExampleController">
  Show Leaderboard:
  <input type="submit" id="show" value="Show" />
</form>




	


</body>
</html>
